var z=Object.defineProperty;var D=(n,e,s)=>e in n?z(n,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[e]=s;var b=(n,e,s)=>D(n,typeof e!="symbol"?e+"":e,s);import{w as R}from"./presets-B67F0CB-.js";import{p as _,n as t,r as d}from"./chunk-D4RADZKF-D4_s_IH5.js";import{aq as g,ar as F,as as N,at as C,au as L,av as G}from"./usePrefersColorScheme-Bi-WMh7j.js";import"./EllipsisOutlined-DMfHtFdL.js";import"./index-D4DweKH7.js";import"./useCSSVarCls-MKdiAhBR.js";import"./AntdIcon-eqsStcNR.js";class M extends _.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,s){console.error("Error in GenericParserViewer:",e,s)}render(){var e;return this.state.hasError?t.jsx(g,{title:"错误",style:{margin:"1rem 0"},children:t.jsxs("p",{children:["组件渲染出错：",(e=this.state.error)==null?void 0:e.message]})}):t.jsx(t.Fragment,{children:this.props.children})}}class O{constructor(e,s,o){b(this,"tokens");b(this,"pos",0);b(this,"derivation",[]);b(this,"grammar");b(this,"start");this.tokens=e,this.grammar=s,this.start=o,this.derivation.push(o)}log(e){this.derivation.push(e)}parseSymbol(e){if(!(e in this.grammar)){if(this.tokens[this.pos]===e){const r={type:e,value:e};return this.pos++,r}return null}const s=this.grammar[e],o=s.filter(r=>r[0]!==e),i=s.filter(r=>r[0]===e).map(r=>r.slice(1));for(const r of o){const a=this.pos;this.log(`${e} → ${r.join(" ")||"ε"}`);const m=[];let x=!0;for(const j of r){if(j==="ε")continue;const l=this.parseSymbol(j);if(!l){x=!1;break}m.push(l)}if(!x){this.pos=a,this.derivation.pop();continue}let c={type:e,children:m.length?m:void 0},h=!0;for(;h;){h=!1;for(const j of i){const l=this.pos;this.log(`${e} → ${e} ${j.join(" ")}`);const p=[];let S=!0;for(const w of j){if(w==="ε")continue;const f=this.parseSymbol(w);if(!f){S=!1;break}p.push(f)}if(!S){this.pos=l,this.derivation.pop();continue}c={type:e,children:[c,...p]},h=!0;break}}return c}return null}run(){const e=this.parseSymbol(this.start);if(!e||this.pos<this.tokens.length)throw new Error(`Parse error at token index ${this.pos}`);return{ast:e,derivation:this.derivation}}}function A(n,e){const s=[...e].sort((r,a)=>a.length-r.length),o=[];let i=0;for(;i<n.length;){if(/\s/.test(n[i])){i++;continue}let r=!1;for(const a of s)if(n.startsWith(a,i)){o.push(a),i+=a.length,r=!0;break}if(!r)throw new Error(`Unknown symbol at position ${i}`)}return o}function B(n,e=0,s=[]){var r;const o=n.value?`${n.type}: ${n.value}`:n.type;s.push(`node${e}["${o}"]`);let i=e+1;return(r=n.children)==null||r.forEach(a=>{const[m,x]=B(a,i,s);s.push(`node${e} --> node${i}`),i=x}),[s,i]}function I(n){return Object.entries(n).map(([e,s])=>`${e} -> ${s.map(o=>o.join(" ")).join(" | ")}`).join(`
`)}function V({expr:n,grammar:e,startSymbol:s}){const[o,i]=d.useState([]),[r,a]=d.useState(""),[m,x]=d.useState(""),[c,h]=d.useState(null),j=F()==="dark"?"dark":"default";return d.useEffect(()=>{try{h(null);const l=new Set(Object.keys(e)),p=new Set;Object.values(e).flat().flat().forEach(v=>{!l.has(v)&&v!=="ε"&&p.add(v)});const S=A(n,Array.from(p)),w=new O(S,e,s),{ast:f}=w.run(),u=[[s]];(function v(k){if(!k.children)return;const y=u[u.length-1],E=y.findIndex($=>$===k.type);if(E>=0){const $=k.children.map(T=>T.type);u.push([...y.slice(0,E),...$,...y.slice(E+1)])}k.children.forEach(v)})(f),i(u.map(v=>v.join(" ")));const[P]=B(f,0,[]);a(["graph TB",...P].join(`
`))}catch(l){h(l)}},[n,e,s]),d.useEffect(()=>{if(c||(N.initialize({startOnLoad:!1,theme:j}),!r))return;const l=`g${Math.random().toString(36).slice(2)}`;N.render(l,r).then(({svg:p})=>x(p)).catch(p=>h(p))},[r,j,c]),c?t.jsx(g,{title:"错误",style:{margin:"1rem 0"},children:t.jsxs("p",{children:["解析或渲染出错：",c.message]})}):t.jsx(M,{children:t.jsxs("div",{className:"mt-4 mb-4",children:[t.jsxs(g,{className:"min-w-[300px]",title:"输入信息",children:[t.jsxs("p",{style:{whiteSpace:"pre-wrap"},children:["输入文法:",t.jsx("b",{children:`
`+I(e)})]}),t.jsxs("p",{children:["开始符号: ",t.jsx("b",{children:s})]}),t.jsxs("p",{children:["目标表达式: ",t.jsx("b",{children:n})]})]}),t.jsx("div",{className:"mt-4 mb-4",children:t.jsx(g,{className:"min-w-[300px]",title:"最左推导",children:t.jsx("ol",{className:"ml-4",children:o.map((l,p)=>t.jsxs("li",{children:["=>",l]},p))})})}),t.jsx(g,{className:"min-w-[300px]",title:"分析树",children:t.jsx("div",{dangerouslySetInnerHTML:{__html:m}})})]})})}const{TextArea:q}=C,{Search:H}=C;function U(n){const e=n.split(`
`).map(o=>o.trim()).filter(o=>o.length>0),s={};for(const o of e){const i=o.split("->");if(i.length!==2)return null;const r=i[0].trim(),a=i[1].trim();if(!r||!a||s[r])return null;const m=[];for(const x of a.split("|")){const c=x.trim().split(/\s+/);if(c.length===0||c.some(h=>h===""))return null;m.push(c)}s[r]=m}return s}const W=`假定文法如下:
exp -> exp addop term | term
addop -> + | -
term -> term mulop factor | factor
mulop -> *
factor -> ( exp ) | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9
写出下面表达式的最左推导和分析树:
(1) 3+4*5-6
(2) 3*(4-5+6)
(3) 3-(4+5*6)
`,J=`假定文法如下:
statement -> if-stmt | other | ε
if-stmt -> if ( exp ) statement else-part
else-part -> else statement | ε
exp -> 0 | 1
(a) 画出句子“if(0) if (1) other else else other”相应的分析树
(b) 解释(a)中两个else的意义?
`,re=R(function(){const[e,s]=d.useState(""),[o,i]=d.useState(""),[r,a]=d.useState(null),[m,x]=d.useState(""),[c,h]=d.useState(!1),[j,l]=d.useState(!0),p=f=>{h(!1);const u=f.target.value;i(u)},S=f=>{h(!1);const u=f.target.value;x(u)},w=f=>{h(!0);const u=U(o);if(!u){l(!1);return}if(a(u),!u[m]){l(!1);return}l(!0),s(f)};return t.jsxs("div",{children:[t.jsxs(L,{justify:"space-around",style:{marginBottom:16},children:[t.jsxs(g,{className:"min-w-[300px]",title:"最左推导与分析树",children:[t.jsx("p",{children:"为描述文法定义的语言,需要使用推导的概念.推导的意思是,把产生式看成重写规则,把符号串中的非终结符用其产生式右部的串来代替.若符号串α中有两个以上的非终结符号,则对推导的每一步坚持把α中的最左非终结符号进行替换,称为最左推导."}),t.jsx("p",{children:"分析树是推导的图形表示.分析树上的每个分支结点都由非终结符标记,它的子结点由该非终结符本次推导所用产生式的右部的各符号从左到右依次来标记.分析树的叶结点由非终结符或终结符标记,所有这些标记从左到右构成一个句型."})]}),t.jsxs(g,{className:"min-w-[300px]",title:"语法提示",style:{marginLeft:16,marginRight:16},children:[t.jsx("p",{children:"使用该工具需要输入文法定义,开始符号,目标表达式."}),t.jsx("p",{children:"文法定义为形如 A -> B | C D | ... 的格式,注意换行"}),t.jsx("p",{children:"开始符号必须为文法定义中的非终止符."})]}),t.jsxs(g,{className:"min-w-[400px]",title:"输入示例",children:[t.jsx(G,{size:"small",style:{marginTop:0},items:[{key:"1",label:"第二次作业1",children:t.jsx("p",{style:{whiteSpace:"pre-wrap"},children:W})}]}),t.jsx(G,{size:"small",style:{marginTop:8},items:[{key:"1",label:"第二次作业2",children:t.jsx("p",{style:{whiteSpace:"pre-wrap"},children:J})}]})]})]}),t.jsx(q,{size:"large",rows:10,placeholder:"请在这里输入文法定义",onChange:p,style:{marginBottom:16}}),t.jsx(C,{size:"large",placeholder:"请在这里输入开始符号",onChange:S,style:{marginBottom:16}}),t.jsx(H,{placeholder:"请输入需要分析的表达式",enterButton:"分析",size:"large",onSearch:w,style:{marginBottom:16}}),c&&t.jsx("div",{children:j?t.jsx(V,{expr:e,grammar:r,startSymbol:m}):t.jsx(g,{title:"分析结果",style:{marginTop:16},children:"文法定义错误或开始符号不在文法中"})})]})});export{re as default};
